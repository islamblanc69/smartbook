<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تفعيل المحتوى</title>
    <style>
        body { 
            font-family: sans-serif; 
            text-align: center; 
            padding: 40px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            
            /* --- هذا هو كود الخلفية --- */
            background-image: url('background.jpg');
            background-size: cover; /* ليغطي كامل الشاشة */
            background-position: center; /* لتوسيط الصورة */
            background-repeat: no-repeat; /* لمنع تكرار الصورة */
            background-attachment: fixed; /* لتثبيت الخلفية */
        }
        
        /* --- صندوق التفعيل بلون أبيض شبه شفاف ليظهر الخلفية --- */
        #activation-form { 
            background-color: rgba(255, 255, 255, 0.95); /* أبيض شبه شفاف */
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); 
        }
        
        input[type="text"] { width: 90%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px; font-size: 1.1em; text-align: center; }
        button { padding: 12px 25px; background-color: #28a745; color: white; border: none; border-radius: 5px; font-size: 1.1em; cursor: pointer; }
        button:hover { background-color: #218838; }
        #loading-message { display: none; font-size: 1.2em; color: white; background-color: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; } /* لون أبيض ليظهر فوق الصورة */
        #error-message { color: red; margin-top: 10px; display: none; background-color: white; padding: 5px; border-radius: 3px;}
    </style>
</head>
<body onload="checkActivation()">

    <div id="loading-message">
        <p>...يتم التحقق...</p>
        <p>سيتم تحويلك الآن</p>
    </div>

    <div id="activation-form" style="display:none;">
        <h1>تفعيل الكتاب</h1>
        <p>الرجاء إدخال كود التفعيل الموجود في كتابك</p>
        <input type="text" id="activation-code" placeholder="أدخل الكود هنا">
        <button onclick="handleActivation()">تفعيل</button>
        <p id="error-message">الكود غير صحيح، يرجى المحاولة مرة أخرى.</p>
    </div>

    <script>
        // --- هذا هو الكود السري الخاص بك ---
        const secretCode = "IQ1423"; 

        // دالة تعمل عند تحميل الصفحة مباشرة
        function checkActivation() {
            if (localStorage.getItem('isBookActivated') === 'true') {
                document.getElementById('activation-form').style.display = 'none';
                document.getElementById('loading-message').style.display = 'block';
                redirectToContentPage();
            } else {
                document.getElementById('activation-form').style.display = 'block';
                document.getElementById('loading-message').style.display = 'none';
            }
        }

        // دالة تعمل عند الضغط على زر "تفعيل"
        function handleActivation() {
            let userInput = document.getElementById('activation-code').value;
            
            // التحقق من الكود المدخل (مع تجاهل حالة الأحرف والفراغات)
            if (userInput.trim().toUpperCase() === secretCode.toUpperCase()) {
                localStorage.setItem('isBookActivated', 'true');
                
                document.getElementById('activation-form').style.display = 'none';
                document.getElementById('loading-message').style.display = 'block';
                document.getElementById('error-message').style.display = 'none';

                redirectToContentPage();

            } else {
                document.getElementById('error-message').style.display = 'block';
            }
        }

        // دالة التوجيه الذكية
        function redirectToContentPage() {
            const urlParams = new URLSearchParams(window.location.search);
            const pageName = urlParams.get('page'); 

            if (pageName) {
                // سيحول إلى "nas.html" أو "falaq.html" الخ
                window.location.replace(pageName + '.html');
            } else {
                document.getElementById('loading-message').innerHTML = '<p>خطأ: رابط غير صحيح.</p>';
            }
        }
    </script>
</body>
</html>
